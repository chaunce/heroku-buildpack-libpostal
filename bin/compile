#!/usr/bin/env bash
# bin/compile <build-dir> <cache-dir> <env-dir>

### Configure environment

set -o errexit    # always exit on error
set -o pipefail   # don't ignore exit codes when piping output
unset GIT_DIR     # Avoid GIT_DIR leak from previous build steps

### Configure directories

BUILD_DIR=${1:-}
CACHE_DIR=${2:-}
ENV_DIR=${3:-}

mkdir -p "${BUILD_DIR}/libpostal"

cd "${BUILD_DIR}/libpostal"

echo "-----> Downloading libpostal in ${BUILD_DIR}/libpostal"

git clone https://github.com/openvenues/libpostal
cd libpostal
./bootstrap.sh
./configure --datadir="${BUILD_DIR}/libpostal"

make
make install
